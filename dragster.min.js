/*@preserve
 * Dragster - drag'n'drop library v1.2.0
 * https://github.com/sunpietro/dragster
 *
 * Copyright 2015 Piotr Nalepa
 * http://blog.piotrnalepa.pl
 *
 * Released under the MIT license
 * https://github.com/sunpietro/dragster/blob/master/LICENSE
 *
 * Date: 2015-08-10T20:30Z
 */
(function(e){var t="dragster",n="undefined";if(typeof exports==="object"&&typeof module!==n){module.exports=e(require(t))}else if(typeof define==="function"&&define.amd){define([t],e)}else{var o;if(typeof window!==n){o=window}else if(typeof global!==n){o=global}else if(typeof self!==n){o=self}else{o=this}o.Dragster=e(o.Dragster)}})(function(e){"use strict";e=function(e){var t="dragster",n="is-dragging",o="is-drag-over",r=t+"-draggable",i=t+"-drag-region",s=t+"-drop-placeholder",a=t+"-temp",l=a+"-container",d=t+"-is-hidden",c=t+"-replacable",u="touchstart",f="touchmove",m="touchend",p="mousedown",g="mousemove",h="mouseup",v="top",y="bottom",E="px",L="div",C=false,B=true,b=function(){},w={elementSelector:".dragster-block",regionSelector:".dragster-region",replaceElements:C,updateRegionsHeight:B,minimumRegionHeight:50,onBeforeDragStart:b,onAfterDragStart:b,onBeforeDragMove:b,onAfterDragMove:b,onBeforeDragEnd:b,onAfterDragEnd:b},A="draggable",N="data-placeholder-position",D={top:C,bottom:C},H={drag:{node:{}},drop:{node:{}},shadow:{node:{},top:0,left:0},placeholder:{node:{},position:""}},S,T,M,R,q,x,O,X,Y,I,P,j,k,F,z,G,J,K,Q,U,V,W,Z,$,_;for(T in e){if(e.hasOwnProperty(T)){w[T]=e[T]}}Z=function(){return Array.prototype.slice.call(document.querySelectorAll(w.elementSelector))};$=function(e){e.forEach(function(e){var t=G(),n=e.parentNode;if(n.classList.contains(r)){return C}n.insertBefore(t,e);n.removeChild(e);t.appendChild(e)})};Y=Z();M=Array.prototype.slice.call(document.querySelectorAll(w.regionSelector));if(w.replaceElements){O=document.createElement(L);O.classList.add(d);O.classList.add(l);document.body.appendChild(O)}R=function(e,t){var n=e.parentNode;if(!n||e.classList&&e.classList.contains(i)){return undefined}if(t(e)){return e}return t(n)?n:R(n,t)};U=function(e){var t=Array.prototype.slice.call(document.getElementsByClassName(e));t.forEach(function(e){e.parentNode.removeChild(e)})};V=function(e,t){M.forEach(function(e){e.removeEventListener(t,I.mousemove)});document.body.removeEventListener(t,I.mousemove);if(e){e.classList.remove(n)}Array.prototype.slice.call(document.getElementsByClassName(r)).forEach(function(e){if(!e.firstChild){e.parentNode.removeChild(e)}});U(s);U(a);_()};W=function(){Array.prototype.slice.call(document.getElementsByClassName(c)).forEach(function(e){e.classList.remove(c)})};G=function(){var e=document.createElement(L);e.setAttribute(A,B);e.classList.add(r);return e};K=function(){var e=document.createElement(L);e.classList.add(s);return e};J=function(){var e=document.createElement(L);e.classList.add(a);e.classList.add(d);document.body.appendChild(e);return e};F=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}};z=function(e,t){if(e&&e.parentNode){e.parentNode.insertBefore(t,e)}};k=function(e){return e.classList&&e.classList.contains(i)};j=function(e){return e.classList&&e.classList.contains(r)};P=function(e){return e.classList&&e.classList.contains(s)};_=function(){if(w.updateRegionsHeight){var e=Array.prototype.slice.call(document.getElementsByClassName(i));e.forEach(function(e){var t=Array.prototype.slice.call(e.querySelectorAll(w.elementSelector)),n=w.minimumRegionHeight;if(t.length){t.forEach(function(e){var t=window.getComputedStyle(e);n+=e.offsetHeight+parseInt(t.marginTop,10)+parseInt(t.marginBottom,10)})}e.style.height=n+E})}};I={mousedown:function(e){e.dragster=S;if(w.onBeforeDragStart(e)===C||e.which===3){return C}e.preventDefault();var t,o=e.type===u?f:g;M.forEach(function(e){e.addEventListener(o,I.mousemove)});document.body.addEventListener(o,I.mousemove);X=R(e.target,j);if(!X){return C}t=X.getBoundingClientRect();q=J();q.innerHTML=X.innerHTML;q.style.width=t.width+E;q.style.height=t.height+E;x=q.getBoundingClientRect();X.classList.add(n);S=H;S.drag.node=X;S.shadow.node=q;e.dragster=S;w.onAfterDragStart(e)},mousemove:function(e){e.dragster=S;if(w.onBeforeDragMove(e)===C){return C}e.preventDefault();var t=e.changedTouches?e.changedTouches[0]:e,n=t.view?t.view.pageXOffset:0,o=t.view?t.view.pageYOffset:0,a=t.clientY+o,l=t.clientX+n,u=document.elementFromPoint(t.clientX,t.clientY),f=R(u,j),m=a+25,p=l-x.width/2,g=K(),h,L;clearTimeout(Q);q.style.top=m+E;q.style.left=p+E;q.classList.remove(d);S.shadow.top=m;S.shadow.left=p;if(f&&f!==X){h=f.getBoundingClientRect();L=h.height/2;W();if(!w.replaceElements){if(a-h.top<L&&!D.top){U(s);g.setAttribute(N,v);z(f.firstChild,g);S.placeholder.position=v}else if(h.bottom-a<L&&!D.bottom){U(s);g.setAttribute(N,y);f.appendChild(g);S.placeholder.position=y}}else{f.classList.add(c)}S.placeholder.node=g;S.drop.node=f}else if(u.classList.contains(i)&&u.getElementsByClassName(r).length===0&&u.getElementsByClassName(s).length===0){u.appendChild(g);S.placeholder.position=y;S.placeholder.node=g;S.drop.node=u}else if(u.classList.contains(i)&&u.getElementsByClassName(r).length>0&&u.getElementsByClassName(s).length===0){var B=u.getElementsByClassName(r);f=B[B.length-1];g.setAttribute(N,y);U(s);f.appendChild(g);S.placeholder.position=y;S.placeholder.node=g;S.drop.node=f}else if(!u.classList.contains(i)){if(!w.replaceElements){U(s)}else{W()}}_();w.onAfterDragMove(e)},mouseup:function(e){e.dragster=S;if(w.onBeforeDragEnd(e)===C){return C}var t=w.replaceElements?c:s,n=document.getElementsByClassName(t)[0],r,i,a=e.type===u?f:g,d;Q=setTimeout(function(){V(X,a)},200);W();if(!X||!n){V(X,a);return C}r=R(n,j);r=r||n;if(X!==r){if(!w.replaceElements){d=G();i=n.getAttribute(N);if(i===v){z(r,d)}else{F(r,d)}if(X.firstChild){d.appendChild(X.firstChild)}}else{d=document.getElementsByClassName(l)[0];d.innerHTML=X.innerHTML;X.innerHTML=r.innerHTML;r.innerHTML=d.innerHTML;d.innerHTML=""}r.classList.remove(o)}V(X,a);w.onAfterDragEnd(e)}};$(Y);document.body.addEventListener(h,I.mouseup,C);document.body.addEventListener(m,I.mouseup,C);M.forEach(function(e){e.classList.add(i);e.addEventListener(p,I.mousedown,C);e.addEventListener(h,I.mouseup,C);e.addEventListener(u,I.mousedown,C);e.addEventListener(m,I.mouseup,C)});return{update:function(){$(Z());_()}}};return e});